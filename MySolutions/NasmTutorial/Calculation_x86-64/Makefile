#																			#
# 	Author: Joris Rietveld <jorisrietveld@gmail.com>						#
#																			#
#	Description:															#
#	Make file for assembling, linking and running assembler programs.		#
#																			#
.DEFAULT_GOAL:=help
BASE_NAME:=main
NAME_ELF:=$(BASE_NAME)
NAME_EXECUTABLE:=$(BASE_NAME)

all: .PRINT_HEADER assemble link run

assemble: $(BASE_NAME).asm ## Assemle the code to binary instuctions.
	@echo "\e[97m Assebling..."
	@nasm -f elf64 -o $(NAME_ELF).o $(BASE_NAME).asm
	@echo  "\t \e[92m Successfully assembled $(BASE_NAME).asm to $(NAME_ELF).o \e[97m"

link: $(BASE_NAME).o ## Assemle the code to binary instuctions.
	@echo  " \nLinking Binary..."
	@ld -o $(NAME_EXECUTABLE) $(NAME_ELF).o
	@echo  "\t  \e[92m Successfully linked $(BASE_NAME).o to $(NAME_EXECUTABLE). \e[97m"

run: $(NAME_EXECUTABLE) ## Run the compiled binary.
	@echo "\n\e[44m Exectuting the program:\e[49m"
	@./$(BASE_NAME)
	@echo "\n"

clean: ## Removes all the files generated by assembling and linking.
	@rm $(NAME_ELF).o $(NAME_EXECUTABLE)
	@echo "All build files are removed!" | cowsay -f `ls /usr/share/cowsay/cows/ | shuf -n 1`


.PRINT_HEADER:
	@toilet -w 800 -F gay -f smmono12 "Making: $(NAME_EXECUTABLE)"

.PHONY: help

help:
	@toilet -w 800 -F gay -f pagga "Help, i dont know what I am doing!"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-30s\033[0m %s\n", $$1, $$2}'



